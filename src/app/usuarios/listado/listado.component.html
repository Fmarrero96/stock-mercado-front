<div class="header">
  <h2>Usuarios</h2>
  <button class="btn-add" (click)="abrirModal()">
    Nuevo
  </button>
</div>

<div class="filters">
  <div class="search">
    <input 
      type="text" 
      [(ngModel)]="termino" 
      (input)="aplicarFiltros()" 
      placeholder="Buscar usuarios..."
    />
  </div>
  
  <div class="role-filter">
    <select 
      [(ngModel)]="rol" 
      (change)="aplicarFiltros()"
    >
      <option value="">Todos los roles</option>
      <option *ngFor="let r of rolesDisponibles" [value]="r.id">{{ r.nombre }}</option>
    </select>
  </div>
</div>

<div class="error" *ngIf="error">{{ error }}</div>

<div class="users-table" *ngIf="filtrados.length > 0; else sinUsuarios">
  <div class="table-header">
    <span>Nombre</span>
    <span>Email</span>
    <span>Rol</span>
    <span></span>
  </div>
  <div *ngFor="let u of usuariosPaginados" class="user-row">
    <span class="name">{{ u.nombre }}</span>
    <span class="email">{{ u.email }}</span>
    <span class="role">{{ getNombreRol(u.rolId) }}</span>
    <div class="actions">
      <button class="btn-edit" (click)="abrirModal(u)">‚úèÔ∏è</button>
    </div>
  </div>
</div>

<div class="pagination" *ngIf="totalPaginas > 1">
  <button 
    class="btn-page" 
    (click)="paginaActual = paginaActual - 1" 
    [disabled]="paginaActual === 1"
  >
    ‚Üê
  </button>
  
  <span class="page-info">{{ paginaActual }} / {{ totalPaginas }}</span>
  
  <button 
    class="btn-page" 
    (click)="paginaActual = paginaActual + 1" 
    [disabled]="paginaActual === totalPaginas"
  >
    ‚Üí
  </button>
</div>

<ng-template #sinUsuarios>
  <div class="empty-state">
    <span class="empty-icon">üë•</span>
    <p>No hay usuarios que coincidan con los filtros.</p>
  </div>
</ng-template>

<!-- Modal -->
<div class="modal" *ngIf="mostrarModal">
  <div class="modal-content">
    <div class="modal-header">
      <span>{{ modoEdicion ? 'Editar' : 'Nuevo' }} Usuario</span>
      <button (click)="cerrarModal()">&times;</button>
    </div>

    <div class="modal-body">
      <form [formGroup]="usuarioForm" (ngSubmit)="guardarUsuario()">
        <div class="form-grid">
          <div class="form-field">
            <label for="nombre">Nombre</label>
            <input 
              id="nombre"
              formControlName="nombre" 
              type="text" 
              placeholder="Nombre del usuario"
              [class.error]="usuarioForm.get('nombre')?.invalid && usuarioForm.get('nombre')?.touched"
            />
            <span class="error" *ngIf="usuarioForm.get('nombre')?.errors?.['required'] && usuarioForm.get('nombre')?.touched">
              Requerido
            </span>
          </div>

          <div class="form-field">
            <label for="email">Email</label>
            <input 
              id="email"
              formControlName="email" 
              type="email" 
              placeholder="Email del usuario"
              [class.error]="usuarioForm.get('email')?.invalid && usuarioForm.get('email')?.touched"
            />
            <span class="error" *ngIf="usuarioForm.get('email')?.errors?.['required'] && usuarioForm.get('email')?.touched">
              Requerido
            </span>
            <span class="error" *ngIf="usuarioForm.get('email')?.errors?.['email'] && usuarioForm.get('email')?.touched">
              Email no v√°lido
            </span>
          </div>

          <div class="form-field">
            <label for="password">Contrase√±a</label>
            <input 
              id="password"
              formControlName="password" 
              type="password" 
              [placeholder]="modoEdicion ? 'Dejar en blanco para no cambiar' : 'Contrase√±a'"
              [class.error]="usuarioForm.get('password')?.invalid && usuarioForm.get('password')?.touched"
            />
            <span class="error" *ngIf="usuarioForm.get('password')?.errors?.['required'] && usuarioForm.get('password')?.touched">
              Requerido
            </span>
          </div>

          <div class="form-field">
            <label for="rol">Rol</label>
            <select 
              id="rol"
              formControlName="rolId"
              [class.error]="usuarioForm.get('rolId')?.invalid && usuarioForm.get('rolId')?.touched"
            >
              <option value="">Seleccionar rol</option>
              <option *ngFor="let r of rolesDisponibles" [value]="r.id">
                {{ r.nombre }}
              </option>
            </select>
            <span class="error" *ngIf="usuarioForm.get('rolId')?.errors?.['required'] && usuarioForm.get('rolId')?.touched">
              Requerido
            </span>
          </div>
        </div>
      </form>
    </div>

    <div class="modal-actions">
      <button type="button" class="btn-cancel" (click)="cerrarModal()">
        Cancelar
      </button>
      <button 
        type="button" 
        class="btn-save" 
        (click)="guardarUsuario()"
        [disabled]="usuarioForm.invalid"
      >
        {{ modoEdicion ? 'Actualizar' : 'Guardar' }}
      </button>
    </div>
  </div>
</div>
