<h2>Gestión de Usuarios</h2>

<div class="acciones-principales">
  <button class="btn-primary" (click)="abrirModal()">
    <span class="icono">➕</span>
    Nuevo usuario
  </button>
</div>

<div class="filtros">
  <div class="filtro-grupo">
    <input 
      type="text" 
      [(ngModel)]="termino" 
      (input)="aplicarFiltros()" 
      placeholder="Buscar por nombre o email..."
      class="filtro-input"
    />
  </div>
  
  <div class="filtro-grupo">
    <select 
      [(ngModel)]="rol" 
      (change)="aplicarFiltros()"
      class="filtro-select"
    >
      <option value="">Todos los roles</option>
      <option *ngFor="let r of rolesDisponibles" [value]="r.id">{{ r.nombre }}</option>
    </select>
  </div>
</div>

<div class="mensaje error" *ngIf="error">{{ error }}</div>

<div class="tabla-contenedor" *ngIf="filtrados.length > 0; else sinUsuarios">
  <table>
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Email</th>
        <th>Rol</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let u of usuariosPaginados">
        <td>{{ u.nombre }}</td>
        <td>{{ u.email }}</td>
        <td>
          <span class="badge">{{ getNombreRol(u.rolId) }}</span>
        </td>
        <td>
          <div class="acciones-tabla">
            <a [routerLink]="['/usuarios/editar', u.id]" class="btn-accion">
              <span class="icono">✏️</span>
              Editar
            </a>
          </div>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<div class="paginacion" *ngIf="totalPaginas > 1">
  <button 
    class="btn-pagina" 
    (click)="paginaActual = paginaActual - 1" 
    [disabled]="paginaActual === 1"
  >
    <span class="icono">⬅️</span>
    Anterior
  </button>
  
  <span class="pagina-info">Página {{ paginaActual }} de {{ totalPaginas }}</span>
  
  <button 
    class="btn-pagina" 
    (click)="paginaActual = paginaActual + 1" 
    [disabled]="paginaActual === totalPaginas"
  >
    Siguiente
    <span class="icono">➡️</span>
  </button>
</div>

<ng-template #sinUsuarios>
  <div class="mensaje-vacio">
    <p>No hay usuarios que coincidan con los filtros.</p>
  </div>
</ng-template>

<!-- Modal de alta -->
<div class="modal" *ngIf="mostrarModal">
  <div class="modal-contenido">
    <h3>Nuevo Usuario</h3>

    <form [formGroup]="formAlta" (ngSubmit)="guardarNuevoUsuario()">
      <div class="form-grupo">
        <label>Nombre</label>
        <input formControlName="nombre" type="text" class="form-control" />
      </div>

      <div class="form-grupo">
        <label>Email</label>
        <input formControlName="email" type="email" class="form-control" />
      </div>

      <div class="form-grupo">
        <label>Contraseña</label>
        <input formControlName="password" type="password" class="form-control" />
      </div>

      <div class="form-grupo">
        <label>Rol</label>
        <select formControlName="rolId" class="form-control">
          <option value="">Seleccione un rol</option>
          <option *ngFor="let r of rolesDisponibles" [value]="r.id">
            {{ r.nombre }}
          </option>
        </select>
      </div>

      <div class="acciones">
        <button type="submit" [disabled]="formAlta.invalid" class="btn-guardar">
          <span class="icono">✅</span>
          Guardar
        </button>
        <button type="button" (click)="cerrarModal()" class="btn-cancelar">
          <span class="icono">❌</span>
          Cancelar
        </button>
      </div>
    </form>
  </div>
</div>
