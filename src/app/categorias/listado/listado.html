<div class="page-header">
  <h2>Gesti√≥n de Categor√≠as</h2>
  <button class="btn-primary" (click)="abrirModalCrear()">
    <span class="icon">‚ûï</span>
    Nueva Categor√≠a
  </button>
</div>

<div class="search-bar">
  <div class="search-input">
    <span class="search-icon">üîç</span>
    <input 
      type="text" 
      [(ngModel)]="terminoBusqueda" 
      (ngModelChange)="filtrarCategorias()"
      placeholder="Buscar categor√≠as..."
    >
  </div>
</div>

<div class="alert error" *ngIf="error">
  <span class="alert-icon">‚ö†Ô∏è</span>
  {{ error }}
</div>

<div class="card" *ngIf="categorias.length > 0; else sinCategorias">
  <div class="table-responsive">
    <table>
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Descripci√≥n</th>
          <th>Estado</th>
          <th>Fecha Creaci√≥n</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let categoria of categoriasFiltradas">
          <td>{{ categoria.nombre }}</td>
          <td>{{ categoria.descripcion || 'Sin descripci√≥n' }}</td>
          <td>
            <span class="badge" 
                  [style.background-color]="categoria.activo ? '#e8f5e8' : '#f5f5f5'"
                  [style.color]="categoria.activo ? '#28a745' : '#6c757d'">
              {{ categoria.activo ? 'Activa' : 'Inactiva' }}
            </span>
          </td>
          <td>{{ categoria.fechaCreacion | date:'dd/MM/yyyy' }}</td>
          <td class="actions">
            <button class="btn-icon primary" (click)="abrirModalEditar(categoria)" title="Editar">
              <span class="icon">‚úèÔ∏è</span>
            </button>
            <button class="btn-icon" 
                    [ngClass]="categoria.activo ? 'danger' : 'success'"
                    (click)="toggleActivarCategoria(categoria)" 
                    [title]="categoria.activo ? 'Desactivar' : 'Activar'">
              <span class="icon">{{ categoria.activo ? '‚ùå' : '‚úÖ' }}</span>
            </button>
            <button class="btn-icon danger" (click)="eliminarCategoria(categoria)" title="Eliminar">
              <span class="icon">üóëÔ∏è</span>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<ng-template #sinCategorias>
  <div class="empty-state">
    <span class="empty-icon">üè∑Ô∏è</span>
    <p>No hay categor√≠as registradas.</p>
  </div>
</ng-template>

<!-- Modal -->
<div class="modal" *ngIf="mostrarModal">
  <div class="modal-backdrop" (click)="cerrarModal()"></div>
  <div class="modal-content">
    <div class="modal-header">
      <h3>{{ modoEdicion ? 'Editar Categor√≠a' : 'Nueva Categor√≠a' }}</h3>
      <button class="btn-icon" (click)="cerrarModal()">
        <span class="icon">‚úñÔ∏è</span>
      </button>
    </div>

    <form [formGroup]="categoriaForm" (ngSubmit)="guardarCategoria()" class="modal-body">
      <div class="form-group">
        <label>Nombre *</label>
        <input 
          type="text" 
          formControlName="nombre"
          placeholder="Ingrese el nombre de la categor√≠a"
          [class.error]="nombreControl?.invalid && nombreControl?.touched"
        >
        <span class="error-message" *ngIf="nombreControl?.invalid && nombreControl?.touched">
          <span *ngIf="nombreControl?.errors?.['required']">El nombre es requerido</span>
          <span *ngIf="nombreControl?.errors?.['minlength']">El nombre debe tener al menos 2 caracteres</span>
          <span *ngIf="nombreControl?.errors?.['maxlength']">El nombre no puede tener m√°s de 50 caracteres</span>
        </span>
      </div>

      <div class="form-group">
        <label>Descripci√≥n</label>
        <textarea 
          formControlName="descripcion"
          placeholder="Descripci√≥n opcional de la categor√≠a"
          rows="3"
          [class.error]="descripcionControl?.invalid && descripcionControl?.touched"
        ></textarea>
        <span class="error-message" *ngIf="descripcionControl?.invalid && descripcionControl?.touched">
          <span *ngIf="descripcionControl?.errors?.['maxlength']">La descripci√≥n no puede tener m√°s de 200 caracteres</span>
        </span>
      </div>

      <div class="form-group">
        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
          <input 
            type="checkbox" 
            formControlName="activo"
          >
          <span>Categor√≠a activa</span>
        </label>
        <span style="font-size: 0.85rem; color: #6c757d; margin-top: 5px; display: block;">
          Las categor√≠as activas aparecen disponibles para asignar a productos
        </span>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-secondary" (click)="cerrarModal()">
          Cancelar
        </button>
        <button 
          type="submit" 
          class="btn-primary" 
          [disabled]="categoriaForm.invalid || guardando"
        >
          {{ guardando ? 'Guardando...' : (modoEdicion ? 'Actualizar' : 'Guardar') }}
        </button>
      </div>
    </form>
  </div>
</div>
