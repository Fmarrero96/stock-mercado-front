<div class="header">
  <h2>Categor√≠as</h2>
  <button class="btn-add" (click)="abrirModalCrear()">
    Nuevo
  </button>
</div>

<div class="search">
  <input 
    #searchInput
    type="text" 
    [(ngModel)]="terminoBusqueda" 
    (ngModelChange)="filtrarCategorias()"
    placeholder="Buscar categor√≠as..."
    id="searchInput"
  >
</div>

<div class="error" *ngIf="error">
  {{ error }}
</div>

<div class="categories-table" *ngIf="categorias.length > 0; else sinCategorias">
  <div class="table-header">
    <span>Nombre</span>
    <span>Descripci√≥n</span>
    <span>Estado</span>
    <span>Creado</span>
    <span></span>
  </div>
  <div *ngFor="let categoria of categoriasFiltradas" class="category-row">
    <span class="name">{{ categoria.nombre }}</span>
    <span class="description">{{ categoria.descripcion || 'Sin descripci√≥n' }}</span>
    <span class="status" [class.active]="categoria.activo" [class.inactive]="!categoria.activo">
      {{ categoria.activo ? 'Activa' : 'Inactiva' }}
    </span>
    <span class="date">{{ categoria.fechaCreacion | date:'dd/MM/yyyy' }}</span>
    <div class="actions">
      <button class="btn-edit" (click)="abrirModalEditar(categoria)">‚úèÔ∏è</button>
      <button class="btn-toggle" [class.danger]="categoria.activo" [class.success]="!categoria.activo" (click)="abrirConfirmacionToggle(categoria)">
        {{ categoria.activo ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è' }}
      </button>
      <button class="btn-delete" (click)="abrirConfirmacionEliminar(categoria)">√ó</button>
    </div>
  </div>
</div>

<ng-template #sinCategorias>
  <div class="empty-state">
    <span class="empty-icon">üè∑Ô∏è</span>
    <p>No hay categor√≠as registradas.</p>
  </div>
</ng-template>

<!-- Modal de Crear/Editar -->
<div class="modal" *ngIf="mostrarModal">
  <div class="modal-content">
    <div class="modal-header">
      <span>{{ modoEdicion ? 'Editar' : 'Nueva' }} Categor√≠a</span>
      <button (click)="cerrarModal()">&times;</button>
    </div>

    <div class="modal-body">
      <form [formGroup]="categoriaForm">
        <div class="form-field">
          <label for="nombre">Nombre</label>
          <input 
            id="nombre"
            type="text" 
            formControlName="nombre"
            [class.error]="nombreControl?.invalid && nombreControl?.touched"
          >
          <span class="error" *ngIf="nombreControl?.invalid && nombreControl?.touched">
            Requerido
          </span>
        </div>

        <div class="form-field">
          <label for="descripcion">Descripci√≥n</label>
          <input 
            id="descripcion"
            type="text"
            formControlName="descripcion"
            placeholder="Descripci√≥n de la categor√≠a"
          >
        </div>
      </form>
    </div>

    <div class="modal-actions">
      <button class="btn-cancel" (click)="cerrarModal()">Cancelar</button>
      <button 
        class="btn-save" 
        (click)="guardarCategoria()"
        [disabled]="guardando"
      >
        {{ guardando ? 'Guardando...' : 'Guardar' }}
      </button>
    </div>
  </div>
</div>

<!-- Modal de Confirmaci√≥n Eliminar -->
<div class="modal" *ngIf="mostrarConfirmacionEliminar">
  <div class="modal-content confirmation">
    <div class="modal-header">
      <span>Eliminar Categor√≠a</span>
    </div>
    <div class="confirmation-content">
      <p>¬øEst√°s seguro de que quieres eliminar esta categor√≠a?</p>
      <div class="category-info" *ngIf="categoriaSeleccionada">
        <div class="info-item">
          <span class="label">Nombre:</span>
          <span class="value">{{ categoriaSeleccionada.nombre }}</span>
        </div>
        <div class="info-item">
          <span class="label">Estado:</span>
          <span class="value">{{ categoriaSeleccionada.activo ? 'Activa' : 'Inactiva' }}</span>
        </div>
      </div>
      <div class="warning">
        Esta acci√≥n no se puede deshacer.
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn-cancel" (click)="cerrarConfirmacionEliminar()">
        Cancelar
      </button>
      <button class="btn-confirm-final danger" (click)="confirmarEliminar()">
        Eliminar
      </button>
    </div>
  </div>
</div>

<!-- Modal de Confirmaci√≥n Toggle -->
<div class="modal" *ngIf="mostrarConfirmacionToggle">
  <div class="modal-content confirmation">
    <div class="modal-header">
      <span>{{ categoriaSeleccionada?.activo ? 'Desactivar' : 'Activar' }} Categor√≠a</span>
    </div>
    <div class="confirmation-content">
      <p>¬øEst√°s seguro de que quieres {{ categoriaSeleccionada?.activo ? 'desactivar' : 'activar' }} esta categor√≠a?</p>
      <div class="category-info" *ngIf="categoriaSeleccionada">
        <div class="info-item">
          <span class="label">Categor√≠a:</span>
          <span class="value">{{ categoriaSeleccionada.nombre }}</span>
        </div>
        <div class="info-item">
          <span class="label">Estado actual:</span>
          <span class="value">{{ categoriaSeleccionada.activo ? 'Activa' : 'Inactiva' }}</span>
        </div>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn-cancel" (click)="cerrarConfirmacionToggle()">
        Cancelar
      </button>
      <button class="btn-confirm-final" [class.danger]="categoriaSeleccionada?.activo" (click)="confirmarToggle()">
        {{ categoriaSeleccionada?.activo ? 'Desactivar' : 'Activar' }}
      </button>
    </div>
  </div>
</div>
